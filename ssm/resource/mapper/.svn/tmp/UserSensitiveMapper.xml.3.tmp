<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="richinfo.mm.monitor.web.dao.UserSensitiveMapper">

	<resultMap id="BaseResultMap" type="UserTest1">
		<result column="name" property="name" jdbcType="VARCHAR" />

		<result column="data" property="data" javaType="java.util.ArrayList"
			jdbcType="VARCHAR" typeHandler="richinfo.mm.monitor.web.enties.common.MyHandler" />
	</resultMap>
	<sql id="Base_Column_List">
		name, age
    </sql>
	<sql id="Base_Column_List2">
		course as name,group_concat(score) as data
    </sql>
	<select id="queryAllUserTest" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List2" />
		from t_score group by course
	</select>
	<!-- 查询页面列表 -->
   <resultMap id="PageResultMap" type="richinfo.mm.monitor.web.enties.PageResult" >
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="url_pattern" property="url_Pattern" jdbcType="VARCHAR" />
    <result column="status" property="status" jdbcType="INTEGER" />
  </resultMap>
   <select id="queryPageResultListPage" resultMap="PageResultMap" >
   		select id,name,url_pattern from  page_conf  	
   		    <where>  
            <if test="pageResult.SearchContent!=null and pageResult.SearchContent!=''">  
                (name like CONCAT('%','${pageResult.SearchContent}','%' )  
                or 
                url_pattern like CONCAT('%','${pageResult.SearchContent}','%' ))  
            </if>  
            <if test="pageResult.businessId != null and pageResult.businessId != ''">
            	and business_id = ${pageResult.businessId}
            </if>
            </where>
   </select>  
	<!-- 查询业务查询条件下拉框的值 -->
	<resultMap type="richinfo.mm.monitor.web.enties.BusinessCategory" id="BCSelValueResultMap">
		<result column="id" property="id" jdbcType="INTEGER" />
		<result column="name" property="name" jdbcType="VARCHAR" />
	</resultMap>
	<select id="queryBCSelValue" resultMap="BCSelValueResultMap">
		select id,name from business_category
	</select>
	
	<select id="getCheckboxInfo" resultMap="BCSelValueResultMap" parameterType="TcpConnParam">
		select 
		<if test="methodType == 'ispDay'">
			isp as id,(case when isp=1 then '电信' when isp=2 then '联通' when isp=3 then '移动' when isp=4 then '教育网' when isp=5 then '铁通' when isp=6 then '网通' else 'UNKNOWN' end) as name from PAGE_DAY_ISP_STAT
		</if>
		<if test="methodType == 'ispHour'">
			isp as id,(case when isp=1 then '电信' when isp=2 then '联通' when isp=3 then '移动' when isp=4 then '教育网' when isp=5 then '铁通' when isp=6 then '网通' else 'UNKNOWN' end) as name from PAGE_HOUR_ISP_STAT
		</if>
		<if test="methodType == 'ispMinute'">
			isp as id,(case when isp=1 then '电信' when isp=2 then '联通' when isp=3 then '移动' when isp=4 then '教育网' when isp=5 then '铁通' when isp=6 then '网通' else 'UNKNOWN' end) as name from PAGE_MINUTE_ISP_STAT
		</if>
		<if test="methodType == 'terminalDay'">
			terminal as id,terminal as name from PAGE_DAY_TERMINAL_STAT
		</if>
		<if test="methodType == 'terminalHour'">
			terminal as id,terminal as name from PAGE_HOUR_TERMINAL_STAT
		</if>
		<if test="methodType == 'terminalMinute'">
			terminal as id,terminal as name from PAGE_MINUTE_TERMINAL_STAT
		</if>
		<if test="methodType == 'cityDay'">
			city as id,(select city from city_info t where t.city_code=city) as name from PAGE_DAY_CITY_STAT
		</if>
		<if test="methodType == 'cityHour'">
			city as id,(select city from city_info t where t.city_code=city) as name from PAGE_HOUR_CITY_STAT
		</if>
		<if test="methodType == 'cityMinute'">
			city as id,(select city from city_info t where t.city_code=city) as name from PAGE_MINUTE_CITY_STAT
		</if>
		<if test="methodType == 'clientDay'">
			client_v as id,client_v as name from PAGE_DAY_CLIENT_STAT
		</if>
		<if test="methodType == 'clientHour'">
			client_v as id,client_v as name from PAGE_HOUR_CLIENT_STAT
		</if>
		<if test="methodType == 'clientMinute'">
			client_v as id,client_v as name from PAGE_MINUTE_CLIENT_STAT
		</if>
		<if test="methodType == 'apDay'">
			ap as id,ap as name from PAGE_DAY_AP_STAT
		</if>
		<if test="methodType == 'apHour'">
			ap as id,ap as name from PAGE_HOUR_AP_STAT
		</if>
		<if test="methodType == 'apMinute'">
			ap as id,ap as name from PAGE_MINUTE_AP_STAT
		</if>
		<if test="methodType == 'errorDay'">
			faultno as id,faultno as name from PAGE_DAY_FAULT_STAT
		</if>
		<if test="methodType == 'errorHour'">
			faultno as id,faultno as name from PAGE_HOUR_FAULT_STAT
		</if>
		<if test="methodType == 'errorMinute'">
			faultno as id,faultno as name from PAGE_MINUTE_FAULT_STAT
		</if>
		<where>
			<if test="productId != null and productId != ''">
				product = #{productId}
			</if>
			<if test="businessId != null and businessId != ''">
				and business_id = #{businessId}
			</if>
			<if test="nodeId != null and nodeId != ''">
				and node = #{nodeId}
			</if>
			<if test="pageId != null and pageId != ''">
				and page_conf_id = #{pageId}
			</if>
			<if test="startDate != null and startDate != ''">
				and createtime >= str_to_date(#{startDate}, '%Y-%m-%d %H:%i:%s')
			</if>
			<if test="endDate != null and endDate != ''">
				and str_to_date(#{endDate}, '%Y-%m-%d %H:%i:%s') >= createtime
			</if>
		</where>
		<if test="methodType == 'ispDay' || methodType == 'ispHour' || methodType == 'ispMinute'">
			group by isp 
		</if>
		<if test="methodType == 'terminalDay' || methodType == 'terminalHour' || methodType == 'terminalMinute'">
			group by terminal 
		</if>
		<if test="methodType == 'cityDay' || methodType == 'cityHour' || methodType == 'cityMinute'">
			group by city 
		</if>
		<if test="methodType == 'clientDay' || methodType == 'clientHour' || methodType == 'clientMinute'">
			group by client_v 
		</if>
		<if test="methodType == 'apDay' || methodType == 'apHour' || methodType == 'apMinute'">
			group by ap 
		</if>
		<if test="methodType == 'errorDay' || methodType == 'errorHour' || methodType == 'errorMinute'">
			group by faultno 
		</if>
		order by avg(connect_time) desc
	</select>
	
	
	<!-- TCP建连时间开始 -->
	<resultMap type="richinfo.mm.monitor.web.enties.TcpConnResult" id="tcpResultMap">
		<result column="createtime" property="createtime" jdbcType="VARCHAR" />
		<result column="name" property="name" jdbcType="VARCHAR" />
		<result column="connect_time" property="data1" jdbcType="FLOAT" />
	</resultMap>
	<select id="queryTcpConnTimeByCond" resultMap="tcpResultMap" parameterType="TcpConnParam">
		select
		<if test="methodType == 'allDay'">
			date_format(createtime, '%Y-%m-%d') as name,sum(connect_time) as data1
			from 
			PAGE_DAY_STAT
		</if>
		<if test="methodType == 'allHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as name,sum(connect_time) as data1
			from 
			PAGE_HOUR_STAT
		</if>
		<if test="methodType == 'allMinute'">
			date_format(createtime, '%Y-%m-%d H:%i') as name,sum(connect_time) as data1
			from 
			PAGE_MINUTE_STAT
		</if>
		<if test="methodType == 'ispDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,(case when isp=1 then '电信' when isp=2 then '联通' when isp=3 then '移动' when isp=4 then '教育网' when isp=5 then '铁通' when isp=6 then '网通' else 'UNKNOWN' end) as name,sum(connect_time) as data1
			from 
			PAGE_DAY_ISP_STAT
		</if>
		<if test="methodType == 'ispHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,(case when isp=1 then '电信' when isp=2 then '联通' when isp=3 then '移动' when isp=4 then '教育网' when isp=5 then '铁通' when isp=6 then '网通' else 'UNKNOWN' end) as name,sum(connect_time) as data1
			from 
			PAGE_HOUR_ISP_STAT
		</if>
		<if test="methodType == 'ispMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,(case when isp=1 then '电信' when isp=2 then '联通' when isp=3 then '移动' when isp=4 then '教育网' when isp=5 then '铁通' when isp=6 then '网通' else 'UNKNOWN' end) as name,sum(connect_time) as data1
			from 
			PAGE_MINUTE_ISP_STAT
		</if>
		<if test="methodType == 'terminalDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,terminal as name,sum(connect_time) as data1
			from 
			PAGE_DAY_TERMINAL_STAT
		</if>
		<if test="methodType == 'terminalHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,terminal as name,sum(connect_time) as data1
			from 
			PAGE_HOUR_TERMINAL_STAT
		</if>
		<if test="methodType == 'terminalMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,terminal as name,sum(connect_time) as data1
			from 
			PAGE_MINUTE_TERMINAL_STAT
		</if>
		<if test="methodType == 'cityDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,(select city from city_info t where t.city_code=city) as name,sum(connect_time) as data1
			from 
			PAGE_DAY_CITY_STAT
		</if>
		<if test="methodType == 'cityHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,(select city from city_info t where t.city_code=city) as name,sum(connect_time) as data1
			from 
			PAGE_HOUR_CITY_STAT
		</if>
		<if test="methodType == 'cityMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,(select city from city_info t where t.city_code=city) as name,sum(connect_time) as data1
			from 
			PAGE_MINUTE_CITY_STAT
		</if>
		<if test="methodType == 'clientDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,client_v as name,sum(connect_time) as data1
			from 
			PAGE_DAY_CLIENT_STAT
		</if>
		<if test="methodType == 'clientHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,client_v as name,sum(connect_time) as data1
			from 
			PAGE_HOUR_CLIENT_STAT
		</if>
		<if test="methodType == 'clientMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,client_v as name,sum(connect_time) as data1
			from 
			PAGE_MINUTE_CLIENT_STAT
		</if>
		<if test="methodType == 'apDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,ap as name,sum(connect_time) as data1
			from 
			PAGE_DAY_AP_STAT
		</if>
		<if test="methodType == 'apHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,ap as name,sum(connect_time) as data1
			from 
			PAGE_HOUR_AP_STAT
		</if>
		<if test="methodType == 'apMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,ap as name,sum(connect_time) as data1
			from 
			PAGE_MINUTE_AP_STAT
		</if>
		<where>
			<if test="productId != null and productId != ''">
				product = #{productId}
			</if>
			<if test="businessId != null and businessId != '' and businessId != 0">
				and business_id = #{businessId}
			</if>
			<if test="nodeId != null and nodeId != '' and nodeId != 0">
				and node = #{nodeId}
			</if>
			<if test="pageId != null and pageId != '' and pageId != 0">
				and page_conf_id = #{pageId}
			</if>
			<if test="startDate != null and startDate != ''">
				and createtime >= str_to_date(#{startDate}, '%Y-%m-%d %H:%i:%s')
			</if>
			<if test="endDate != null and endDate != ''">
				and str_to_date(#{endDate}, '%Y-%m-%d %H:%i:%s') >= createtime
			</if>
			<if test="checkedValue != null and checkedValue != ''">
				and 
				<if test="methodType == 'ispDay' || methodType == 'ispHour' || methodType == 'ispMinute'">
					isp 
				</if>
				<if test="methodType == 'terminalDay' || methodType == 'terminalHour' || methodType == 'terminalMinute'">
					terminal 
				</if>
				<if test="methodType == 'cityDay' || methodType == 'cityHour' || methodType == 'cityMinute'">
					city 
				</if>
				<if test="methodType == 'clientDay' || methodType == 'clientHour' || methodType == 'clientMinute'">
					client_v 
				</if>
				<if test="methodType == 'apDay' || methodType == 'apHour' || methodType == 'apMinute'">
					ap 
				</if>
				in
				<foreach collection="checkedValArr" item="checkedItem" index="index" open="(" close=")" separator=",">
					#{checkedItem}
				</foreach>
			</if>
		</where>
		<if test="businessId == 0 || nodeId == 0 || pageId == 0">
			group by createtime order by createtime asc, sum(connect_time) desc
		</if>
		<if test="businessId != 0 and nodeId != 0 and pageId != 0">
			order by createtime asc, connect_time desc
		</if>
	</select>
	<!-- TCP建连时间结束 -->
	
	
	<!-- 页面首包时间开始 -->
	<resultMap type="richinfo.mm.monitor.web.enties.TcpConnResult" id="firstPacketResultMap">
		<result column="createtime" property="createtime" jdbcType="VARCHAR" />
		<result column="name" property="name" jdbcType="VARCHAR" />
		<result column="first_packet_time" property="data1" jdbcType="FLOAT" />
	</resultMap>
	<select id="queryFirstPaketTimeByCond" resultMap="firstPacketResultMap" parameterType="TcpConnParam">
		select
		<if test="methodType == 'allDay'">
			date_format(createtime, '%Y-%m-%d') as name,sum(first_packet_time) as data1
			from 
			PAGE_DAY_STAT
		</if>
		<if test="methodType == 'allHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as name,sum(first_packet_time) as data1
			from 
			PAGE_HOUR_STAT
		</if>
		<if test="methodType == 'allMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as name,sum(first_packet_time) as data1
			from 
			PAGE_MINUTE_STAT
		</if>
		<if test="methodType == 'ispDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,isp as name,sum(first_packet_time) as data1
			from 
			PAGE_DAY_ISP_STAT
		</if>
		<if test="methodType == 'ispHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,isp as name,sum(first_packet_time) as data1
			from 
			PAGE_HOUR_ISP_STAT
		</if>
		<if test="methodType == 'ispMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,isp as name,sum(first_packet_time) as data1
			from 
			PAGE_MINUTE_ISP_STAT
		</if>
		<if test="methodType == 'terminalDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,terminal as name,sum(first_packet_time) as data1
			from 
			PAGE_DAY_TERMINAL_STAT
		</if>
		<if test="methodType == 'terminalHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,terminal as name,sum(first_packet_time) as data1
			from 
			PAGE_HOUR_TERMINAL_STAT
		</if>
		<if test="methodType == 'terminalMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,terminal as name,sum(first_packet_time) as data1
			from 
			PAGE_MINUTE_TERMINAL_STAT
		</if>
		<if test="methodType == 'cityDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,city as name,sum(first_packet_time) as data1
			from 
			PAGE_DAY_CITY_STAT
		</if>
		<if test="methodType == 'cityHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,city as name,sum(first_packet_time) as data1
			from 
			PAGE_HOUR_CITY_STAT
		</if>
		<if test="methodType == 'cityMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,city as name,sum(first_packet_time) as data1
			from 
			PAGE_MINUTE_CITY_STAT
		</if>
		<if test="methodType == 'clientDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,client_v as name,sum(first_packet_time) as data1
			from 
			PAGE_DAY_CLIENT_STAT
		</if>
		<if test="methodType == 'clientHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,client_v as name,sum(first_packet_time) as data1
			from 
			PAGE_HOUR_CLIENT_STAT
		</if>
		<if test="methodType == 'clientMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,client_v as name,sum(first_packet_time) as data1
			from 
			PAGE_MINUTE_CLIENT_STAT
		</if>
		<if test="methodType == 'apDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,ap as name,sum(first_packet_time) as data1
			from 
			PAGE_DAY_AP_STAT
		</if>
		<if test="methodType == 'apHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,ap as name,sum(first_packet_time) as data1
			from 
			PAGE_HOUR_AP_STAT
		</if>
		<if test="methodType == 'apMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,ap as name,sum(first_packet_time) as data1
			from 
			PAGE_MINUTE_AP_STAT
		</if>
		<where>
			<if test="productId != null and productId != ''">
				product = #{productId}
			</if>
			<if test="businessId != null and businessId != '' and businessId != 0">
				and business_id = #{businessId}
			</if>
			<if test="nodeId != null and nodeId != '' and nodeId != 0">
				and node = #{nodeId}
			</if>
			<if test="pageId != null and pageId != '' and pageId != 0">
				and page_conf_id = #{pageId}
			</if>
			<if test="startDate != null and startDate != ''">
				and createtime >= str_to_date(#{startDate}, '%Y-%m-%d %H:%i:%s')
			</if>
			<if test="endDate != null and endDate != ''">
				and str_to_date(#{endDate}, '%Y-%m-%d %H:%i:%s') >= createtime
			</if>
			<if test="checkedValue != null and checkedValue != ''">
				and 
				<if test="methodType == 'ispDay' || methodType == 'ispHour' || methodType == 'ispMinute'">
					isp 
				</if>
				<if test="methodType == 'terminalDay' || methodType == 'terminalHour' || methodType == 'terminalMinute'">
					terminal 
				</if>
				<if test="methodType == 'cityDay' || methodType == 'cityHour' || methodType == 'cityMinute'">
					city 
				</if>
				<if test="methodType == 'clientDay' || methodType == 'clientHour' || methodType == 'clientMinute'">
					client_v 
				</if>
				<if test="methodType == 'apDay' || methodType == 'apHour' || methodType == 'apMinute'">
					ap 
				</if>
				in
				<foreach collection="checkedValArr" item="checkedItem" index="index" open="(" close=")" separator=",">
					#{checkedItem}
				</foreach>
			</if>
		</where>
		<if test="businessId == 0 || nodeId == 0 || pageId == 0">
			group by createtime order by createtime asc, sum(first_packet_time) desc
		</if>
		<if test="businessId != 0 and nodeId != 0 and pageId != 0">
			order by createtime asc, first_packet_time desc
		</if>
	</select>
	<!-- 页面首包时间结束 -->
	<!-- 页面服务器时间开始 -->
	<resultMap type="richinfo.mm.monitor.web.enties.TcpConnResult" id="remaningPacketResultMap">
		<result column="createtime" property="createtime" jdbcType="VARCHAR" />
		<result column="name" property="name" jdbcType="VARCHAR" />
		<result column="remaning_packet_time" property="data1" jdbcType="FLOAT" />
	</resultMap>
	<select id="queryRemaningPaketTimeByCond" resultMap="remaningPacketResultMap" parameterType="TcpConnParam">
		select
		<if test="methodType == 'allDay'">
			date_format(createtime, '%Y-%m-%d') as name,sum(remaning_packet_time) as data1
			from 
			PAGE_DAY_STAT
		</if>
		<if test="methodType == 'allHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as name,sum(remaning_packet_time) as data1
			from 
			PAGE_HOUR_STAT
		</if>
		<if test="methodType == 'allMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as name,sum(remaning_packet_time) as data1
			from 
			PAGE_MINUTE_STAT
		</if>
		<if test="methodType == 'ispDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,isp as name,sum(remaning_packet_time) as data1
			from 
			PAGE_DAY_ISP_STAT
		</if>
		<if test="methodType == 'ispHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,isp as name,sum(remaning_packet_time) as data1
			from 
			PAGE_HOUR_ISP_STAT
		</if>
		<if test="methodType == 'ispMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,isp as name,sum(remaning_packet_time) as data1
			from 
			PAGE_MINUTE_ISP_STAT
		</if>
		<if test="methodType == 'terminalDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,terminal as name,sum(remaning_packet_time) as data1
			from 
			PAGE_DAY_TERMINAL_STAT
		</if>
		<if test="methodType == 'terminalHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,terminal as name,sum(remaning_packet_time) as data1
			from 
			PAGE_HOUR_TERMINAL_STAT
		</if>
		<if test="methodType == 'terminalMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,terminal as name,sum(remaning_packet_time) as data1
			from 
			PAGE_MINUTE_TERMINAL_STAT
		</if>
		<if test="methodType == 'cityDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,city as name,sum(remaning_packet_time) as data1
			from 
			PAGE_DAY_CITY_STAT
		</if>
		<if test="methodType == 'cityHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,city as name,sum(remaning_packet_time) as data1
			from 
			PAGE_HOUR_CITY_STAT
		</if>
		<if test="methodType == 'cityMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,city as name,sum(remaning_packet_time) as data1
			from 
			PAGE_MINUTE_CITY_STAT
		</if>
		<if test="methodType == 'clientDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,client_v as name,sum(remaning_packet_time) as data1
			from 
			PAGE_DAY_CLIENT_STAT
		</if>
		<if test="methodType == 'clientHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,client_v as name,sum(remaning_packet_time) as data1
			from 
			PAGE_HOUR_CLIENT_STAT
		</if>
		<if test="methodType == 'clientMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,client_v as name,sum(remaning_packet_time) as data1
			from 
			PAGE_MINUTE_CLIENT_STAT
		</if>
		<if test="methodType == 'apDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,ap as name,sum(remaning_packet_time) as data1
			from 
			PAGE_DAY_AP_STAT
		</if>
		<if test="methodType == 'apHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,ap as name,sum(remaning_packet_time) as data1
			from 
			PAGE_HOUR_AP_STAT
		</if>
		<if test="methodType == 'apMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,ap as name,sum(remaning_packet_time) as data1
			from 
			PAGE_MINUTE_AP_STAT
		</if>
		<where>
			<if test="productId != null and productId != ''">
				product = #{productId}
			</if>
			<if test="businessId != null and businessId != '' and businessId != 0">
				and business_id = #{businessId}
			</if>
			<if test="nodeId != null and nodeId != '' and nodeId != 0">
				and node = #{nodeId}
			</if>
			<if test="pageId != null and pageId != '' and pageId != 0">
				and page_conf_id = #{pageId}
			</if>
			<if test="startDate != null and startDate != ''">
				and createtime >= str_to_date(#{startDate}, '%Y-%m-%d %H:%i:%s')
			</if>
			<if test="endDate != null and endDate != ''">
				and str_to_date(#{endDate}, '%Y-%m-%d %H:%i:%s') >= createtime
			</if>
			<if test="checkedValue != null and checkedValue != ''">
				and 
				<if test="methodType == 'ispDay' || methodType == 'ispHour' || methodType == 'ispMinute'">
					isp 
				</if>
				<if test="methodType == 'terminalDay' || methodType == 'terminalHour' || methodType == 'terminalMinute'">
					terminal 
				</if>
				<if test="methodType == 'cityDay' || methodType == 'cityHour' || methodType == 'cityMinute'">
					city 
				</if>
				<if test="methodType == 'clientDay' || methodType == 'clientHour' || methodType == 'clientMinute'">
					client_v 
				</if>
				<if test="methodType == 'apDay' || methodType == 'apHour' || methodType == 'apMinute'">
					ap 
				</if>
				in
				<foreach collection="checkedValArr" item="checkedItem" index="index" open="(" close=")" separator=",">
					#{checkedItem}
				</foreach>
			</if>
		</where>
		<if test="businessId == 0 || nodeId == 0 || pageId == 0">
			group by createtime order by createtime asc, sum(remaning_packet_time) desc
		</if>
		<if test="businessId != 0 and nodeId != 0 and pageId != 0">
			order by createtime asc, remaning_packet_time desc
		</if>
	</select>
	<!-- 页面服务器时间结束 -->
	
	<!-- 页面总下载时间开始 -->
	<resultMap type="richinfo.mm.monitor.web.enties.TcpConnResult" id="downsResultMap">
		<result column="createtime" property="createtime" jdbcType="VARCHAR" />
		<result column="name" property="name" jdbcType="VARCHAR" />
		<result column="data1" property="data1" jdbcType="FLOAT" />
	</resultMap>
	<select id="queryDownsTimeByCond" resultMap="downsResultMap" parameterType="TcpConnParam">
		select
		<if test="methodType == 'allDay'">
			date_format(createtime, '%Y-%m-%d') as name,sum(first_packet_time+remaning_packet_time) as data1
			from 
			PAGE_DAY_STAT
		</if>
		<if test="methodType == 'allHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as name,sum(first_packet_time+remaning_packet_time) as data1
			from 
			PAGE_HOUR_STAT
		</if>
		<if test="methodType == 'allMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as name,sum(first_packet_time+remaning_packet_time) as data1
			from 
			PAGE_MINUTE_STAT
		</if>
		<if test="methodType == 'ispDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,isp as name,sum(first_packet_time+remaning_packet_time) as data1
			from 
			PAGE_DAY_ISP_STAT
		</if>
		<if test="methodType == 'ispHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,isp as name,sum(first_packet_time+remaning_packet_time) as data1
			from 
			PAGE_HOUR_ISP_STAT
		</if>
		<if test="methodType == 'ispMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,isp as name,sum(first_packet_time+remaning_packet_time) as data1
			from 
			PAGE_MINUTE_ISP_STAT
		</if>
		<if test="methodType == 'terminalDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,terminal as name,sum(first_packet_time+remaning_packet_time) as data1
			from 
			PAGE_DAY_TERMINAL_STAT
		</if>
		<if test="methodType == 'terminalHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,terminal as name,sum(first_packet_time+remaning_packet_time) as data1
			from 
			PAGE_HOUR_TERMINAL_STAT
		</if>
		<if test="methodType == 'terminalMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,terminal as name,sum(first_packet_time+remaning_packet_time) as data1
			from 
			PAGE_MINUTE_TERMINAL_STAT
		</if>
		<if test="methodType == 'cityDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,city as name,sum(first_packet_time+remaning_packet_time) as data1
			from 
			PAGE_DAY_CITY_STAT
		</if>
		<if test="methodType == 'cityHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,city as name,sum(first_packet_time+remaning_packet_time) as data1
			from 
			PAGE_HOUR_CITY_STAT
		</if>
		<if test="methodType == 'cityMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,city as name,sum(first_packet_time+remaning_packet_time) as data1
			from 
			PAGE_MINUTE_CITY_STAT
		</if>
		<if test="methodType == 'clientDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,client_v as name,sum(first_packet_time+remaning_packet_time) as data1
			from 
			PAGE_DAY_CLIENT_STAT
		</if>
		<if test="methodType == 'clientHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,client_v as name,sum(first_packet_time+remaning_packet_time) as data1
			from 
			PAGE_HOUR_CLIENT_STAT
		</if>
		<if test="methodType == 'clientMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,client_v as name,sum(first_packet_time+remaning_packet_time) as data1
			from 
			PAGE_MINUTE_CLIENT_STAT
		</if>
		<if test="methodType == 'apDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,ap as name,sum(first_packet_time+remaning_packet_time) as data1
			from 
			PAGE_DAY_AP_STAT
		</if>
		<if test="methodType == 'apHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,ap as name,sum(first_packet_time+remaning_packet_time) as data1
			from 
			PAGE_HOUR_AP_STAT
		</if>
		<if test="methodType == 'apMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,ap as name,sum(first_packet_time+remaning_packet_time) as data1
			from 
			PAGE_MINUTE_AP_STAT
		</if>
		<where>
			<if test="productId != null and productId != ''">
				product = #{productId}
			</if>
			<if test="businessId != null and businessId != '' and businessId != 0">
				and business_id = #{businessId}
			</if>
			<if test="nodeId != null and nodeId != '' and nodeId != 0">
				and node = #{nodeId}
			</if>
			<if test="pageId != null and pageId != '' and pageId != 0">
				and page_conf_id = #{pageId}
			</if>
			<if test="startDate != null and startDate != ''">
				and createtime >= str_to_date(#{startDate}, '%Y-%m-%d %H:%i:%s')
			</if>
			<if test="endDate != null and endDate != ''">
				and str_to_date(#{endDate}, '%Y-%m-%d %H:%i:%s') >= createtime
			</if>
			<if test="checkedValue != null and checkedValue != ''">
				and 
				<if test="methodType == 'ispDay' || methodType == 'ispHour' || methodType == 'ispMinute'">
					isp 
				</if>
				<if test="methodType == 'terminalDay' || methodType == 'terminalHour' || methodType == 'terminalMinute'">
					terminal 
				</if>
				<if test="methodType == 'cityDay' || methodType == 'cityHour' || methodType == 'cityMinute'">
					city 
				</if>
				<if test="methodType == 'clientDay' || methodType == 'clientHour' || methodType == 'clientMinute'">
					client_v 
				</if>
				<if test="methodType == 'apDay' || methodType == 'apHour' || methodType == 'apMinute'">
					ap 
				</if>
				in
				<foreach collection="checkedValArr" item="checkedItem" index="index" open="(" close=")" separator=",">
					#{checkedItem}
				</foreach>
			</if>
		</where>
		<if test="businessId == 0 || nodeId == 0 || pageId == 0">
			group by createtime order by createtime asc, sum(first_packet_time+remaning_packet_time) desc
		</if>
		<if test="businessId != 0 and nodeId != 0 and pageId != 0">
			order by createtime asc, (first_packet_time+remaning_packet_time) desc
		</if>
	</select>
	<!-- 页面总下载时间结束 -->
	<!-- 页面丢包率开始 -->
	<resultMap type="richinfo.mm.monitor.web.enties.TcpConnResult" id="lossResultMap">
		<result column="createtime" property="createtime" jdbcType="VARCHAR" />
		<result column="name" property="name" jdbcType="VARCHAR" />
		<result column="retry_nums" property="data1" jdbcType="FLOAT" />
	</resultMap>
	<select id="queryLossByCond" resultMap="lossResultMap" parameterType="TcpConnParam">
		select
		<if test="methodType == 'allDay'">
			date_format(createtime, '%Y-%m-%d') as name,sum(retry_nums) as data1
			from 
			PAGE_DAY_STAT
		</if>
		<if test="methodType == 'allHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as name,sum(retry_nums) as data1
			from 
			PAGE_HOUR_STAT
		</if>
		<if test="methodType == 'allMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as name,sum(retry_nums) as data1
			from 
			PAGE_MINUTE_STAT
		</if>
		<if test="methodType == 'ispDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,isp as name,sum(retry_nums) as data1
			from 
			PAGE_DAY_ISP_STAT
		</if>
		<if test="methodType == 'ispHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,isp as name,sum(retry_nums) as data1
			from 
			PAGE_HOUR_ISP_STAT
		</if>
		<if test="methodType == 'ispMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,isp as name,sum(retry_nums) as data1
			from 
			PAGE_MINUTE_ISP_STAT
		</if>
		<if test="methodType == 'terminalDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,terminal as name,sum(retry_nums) as data1
			from 
			PAGE_DAY_TERMINAL_STAT
		</if>
		<if test="methodType == 'terminalHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,terminal as name,sum(retry_nums) as data1
			from 
			PAGE_HOUR_TERMINAL_STAT
		</if>
		<if test="methodType == 'terminalMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,terminal as name,sum(retry_nums) as data1
			from 
			PAGE_MINUTE_TERMINAL_STAT
		</if>
		<if test="methodType == 'cityDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,city as name,sum(retry_nums) as data1
			from 
			PAGE_DAY_CITY_STAT
		</if>
		<if test="methodType == 'cityHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,city as name,sum(retry_nums) as data1
			from 
			PAGE_HOUR_CITY_STAT
		</if>
		<if test="methodType == 'cityMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,city as name,sum(retry_nums) as data1
			from 
			PAGE_MINUTE_CITY_STAT
		</if>
		<if test="methodType == 'clientDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,client_v as name,sum(retry_nums) as data1
			from 
			PAGE_DAY_CLIENT_STAT
		</if>
		<if test="methodType == 'clientHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,client_v as name,sum(retry_nums) as data1
			from 
			PAGE_HOUR_CLIENT_STAT
		</if>
		<if test="methodType == 'clientMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,client_v as name,sum(retry_nums) as data1
			from 
			PAGE_MINUTE_CLIENT_STAT
		</if>
		<if test="methodType == 'apDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,ap as name,sum(retry_nums) as data1
			from 
			PAGE_DAY_AP_STAT
		</if>
		<if test="methodType == 'apHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,ap as name,sum(retry_nums) as data1
			from 
			PAGE_HOUR_AP_STAT
		</if>
		<if test="methodType == 'apMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,ap as name,sum(retry_nums) as data1
			from 
			PAGE_MINUTE_AP_STAT
		</if>
		<where>
			<if test="productId != null and productId != ''">
				product = #{productId}
			</if>
			<if test="businessId != null and businessId != '' and businessId != 0">
				and business_id = #{businessId}
			</if>
			<if test="nodeId != null and nodeId != '' and nodeId != 0">
				and node = #{nodeId}
			</if>
			<if test="pageId != null and pageId != '' and pageId != 0">
				and page_conf_id = #{pageId}
			</if>
			<if test="startDate != null and startDate != ''">
				and createtime >= str_to_date(#{startDate}, '%Y-%m-%d %H:%i:%s')
			</if>
			<if test="endDate != null and endDate != ''">
				and str_to_date(#{endDate}, '%Y-%m-%d %H:%i:%s') >= createtime
			</if>
			<if test="checkedValue != null and checkedValue != ''">
				and 
				<if test="methodType == 'ispDay' || methodType == 'ispHour' || methodType == 'ispMinute'">
					isp 
				</if>
				<if test="methodType == 'terminalDay' || methodType == 'terminalHour' || methodType == 'terminalMinute'">
					terminal 
				</if>
				<if test="methodType == 'cityDay' || methodType == 'cityHour' || methodType == 'cityMinute'">
					city 
				</if>
				<if test="methodType == 'clientDay' || methodType == 'clientHour' || methodType == 'clientMinute'">
					client_v 
				</if>
				<if test="methodType == 'apDay' || methodType == 'apHour' || methodType == 'apMinute'">
					ap 
				</if>
				in
				<foreach collection="checkedValArr" item="checkedItem" index="index" open="(" close=")" separator=",">
					#{checkedItem}
				</foreach>
			</if>
		</where>
		<if test="businessId == 0 || nodeId == 0 || pageId == 0">
			group by createtime order by createtime asc, sum(retry_nums) desc
		</if>
		<if test="businessId != 0 and nodeId != 0 and pageId != 0">
			order by createtime asc, retry_nums desc
		</if>
	</select>
	<!-- 页面丢包率结束 -->
	
	<!-- 页面响应时间开始 -->
	<resultMap type="richinfo.mm.monitor.web.enties.TcpConnResult" id="responseResultMap">
		<result column="createtime" property="createtime" jdbcType="VARCHAR" />
		<result column="name" property="name" jdbcType="VARCHAR" />
		<result column="resp_time" property="data1" jdbcType="FLOAT" />
	</resultMap>
	<select id="queryResponseByCond" resultMap="responseResultMap" parameterType="TcpConnParam">
		select
		<if test="methodType == 'allDay'">
			date_format(createtime, '%Y-%m-%d') as name,sum(resp_time) as data1
			from 
			PAGE_DAY_STAT
		</if>
		<if test="methodType == 'allHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as name,sum(resp_time) as data1
			from 
			PAGE_HOUR_STAT
		</if>
		<if test="methodType == 'allMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as name,sum(resp_time) as data1
			from 
			PAGE_MINUTE_STAT
		</if>
		<if test="methodType == 'ispDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,isp as name,sum(resp_time) as data1
			from 
			PAGE_DAY_ISP_STAT
		</if>
		<if test="methodType == 'ispHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,isp as name,sum(resp_time) as data1
			from 
			PAGE_HOUR_ISP_STAT
		</if>
		<if test="methodType == 'ispMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,isp as name,sum(resp_time) as data1
			from 
			PAGE_MINUTE_ISP_STAT
		</if>
		<if test="methodType == 'terminalDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,terminal as name,sum(resp_time) as data1
			from 
			PAGE_DAY_TERMINAL_STAT
		</if>
		<if test="methodType == 'terminalHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,terminal as name,sum(resp_time) as data1
			from 
			PAGE_HOUR_TERMINAL_STAT
		</if>
		<if test="methodType == 'terminalMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,terminal as name,sum(resp_time) as data1
			from 
			PAGE_MINUTE_TERMINAL_STAT
		</if>
		<if test="methodType == 'cityDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,city as name,sum(resp_time) as data1
			from 
			PAGE_DAY_CITY_STAT
		</if>
		<if test="methodType == 'cityHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,city as name,sum(resp_time) as data1
			from 
			PAGE_HOUR_CITY_STAT
		</if>
		<if test="methodType == 'cityMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,city as name,sum(resp_time) as data1
			from 
			PAGE_MINUTE_CITY_STAT
		</if>
		<if test="methodType == 'clientDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,client_v as name,sum(resp_time) as data1
			from 
			PAGE_DAY_CLIENT_STAT
		</if>
		<if test="methodType == 'clientHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,client_v as name,sum(resp_time) as data1
			from 
			PAGE_HOUR_CLIENT_STAT
		</if>
		<if test="methodType == 'clientMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,client_v as name,sum(resp_time) as data1
			from 
			PAGE_MINUTE_CLIENT_STAT
		</if>
		<if test="methodType == 'apDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,ap as name,sum(resp_time) as data1
			from 
			PAGE_DAY_AP_STAT
		</if>
		<if test="methodType == 'apHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,ap as name,sum(resp_time) as data1
			from 
			PAGE_HOUR_AP_STAT
		</if>
		<if test="methodType == 'apMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,ap as name,sum(resp_time) as data1
			from 
			PAGE_MINUTE_AP_STAT
		</if>
		<where>
			<if test="productId != null and productId != ''">
				product = #{productId}
			</if>
			<if test="businessId != null and businessId != '' and businessId != 0">
				and business_id = #{businessId}
			</if>
			<if test="nodeId != null and nodeId != '' and nodeId != 0">
				and node = #{nodeId}
			</if>
			<if test="pageId != null and pageId != '' and pageId != 0">
				and page_conf_id = #{pageId}
			</if>
			<if test="startDate != null and startDate != ''">
				and createtime >= str_to_date(#{startDate}, '%Y-%m-%d %H:%i:%s')
			</if>
			<if test="endDate != null and endDate != ''">
				and str_to_date(#{endDate}, '%Y-%m-%d %H:%i:%s') >= createtime
			</if>
			<if test="checkedValue != null and checkedValue != ''">
				and 
				<if test="methodType == 'ispDay' || methodType == 'ispHour' || methodType == 'ispMinute'">
					isp 
				</if>
				<if test="methodType == 'terminalDay' || methodType == 'terminalHour' || methodType == 'terminalMinute'">
					terminal 
				</if>
				<if test="methodType == 'cityDay' || methodType == 'cityHour' || methodType == 'cityMinute'">
					city 
				</if>
				<if test="methodType == 'clientDay' || methodType == 'clientHour' || methodType == 'clientMinute'">
					client_v 
				</if>
				<if test="methodType == 'apDay' || methodType == 'apHour' || methodType == 'apMinute'">
					ap 
				</if>
				in
				<foreach collection="checkedValArr" item="checkedItem" index="index" open="(" close=")" separator=",">
					#{checkedItem}
				</foreach>
			</if>
		</where>
		<if test="businessId == 0 || nodeId == 0 || pageId == 0">
			group by createtime order by createtime asc, sum(resp_time) desc
		</if>
		<if test="businessId != 0 and nodeId != 0 and pageId != 0">
			order by createtime asc, resp_time desc
		</if>
	</select>
	<!-- 页面响应时间结束 -->
	
	
	<!-- 点击量开始 -->
	<resultMap type="richinfo.mm.monitor.web.enties.TcpConnResult" id="hitsResultMap">
		<result column="createtime" property="createtime" jdbcType="VARCHAR" />
		<result column="name" property="name" jdbcType="VARCHAR" />
		<result column="hits" property="data1" jdbcType="FLOAT" />
	</resultMap>
	<select id="queryHitsByCond" resultMap="hitsResultMap" parameterType="TcpConnParam">
		select
		<if test="methodType == 'allDay'">
			date_format(createtime, '%Y-%m-%d') as name,sum(hits) as data1
			from 
			PAGE_DAY_STAT
		</if>
		<if test="methodType == 'allHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as name,sum(hits) as data1
			from 
			PAGE_HOUR_STAT
		</if>
		<if test="methodType == 'allMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as name,sum(hits) as data1
			from 
			PAGE_MINUTE_STAT
		</if>
		<if test="methodType == 'ispDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,isp as name,sum(hits) as data1
			from 
			PAGE_DAY_ISP_STAT
		</if>
		<if test="methodType == 'ispHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,isp as name,sum(hits) as data1
			from 
			PAGE_HOUR_ISP_STAT
		</if>
		<if test="methodType == 'ispMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,isp as name,sum(hits) as data1
			from 
			PAGE_MINUTE_ISP_STAT
		</if>
		<if test="methodType == 'terminalDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,terminal as name,sum(hits) as data1
			from 
			PAGE_DAY_TERMINAL_STAT
		</if>
		<if test="methodType == 'terminalHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,terminal as name,sum(hits) as data1
			from 
			PAGE_HOUR_TERMINAL_STAT
		</if>
		<if test="methodType == 'terminalMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,terminal as name,sum(hits) as data1
			from 
			PAGE_MINUTE_TERMINAL_STAT
		</if>
		<if test="methodType == 'cityDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,city as name,sum(hits) as data1
			from 
			PAGE_DAY_CITY_STAT
		</if>
		<if test="methodType == 'cityHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,city as name,sum(hits) as data1
			from 
			PAGE_HOUR_CITY_STAT
		</if>
		<if test="methodType == 'cityMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,city as name,sum(hits) as data1
			from 
			PAGE_MINUTE_CITY_STAT
		</if>
		<if test="methodType == 'clientDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,client_v as name,sum(hits) as data1
			from 
			PAGE_DAY_CLIENT_STAT
		</if>
		<if test="methodType == 'clientHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,client_v as name,sum(hits) as data1
			from 
			PAGE_HOUR_CLIENT_STAT
		</if>
		<if test="methodType == 'clientMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,client_v as name,sum(hits) as data1
			from 
			PAGE_MINUTE_CLIENT_STAT
		</if>
		<if test="methodType == 'apDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,ap as name,sum(hits) as data1
			from 
			PAGE_DAY_AP_STAT
		</if>
		<if test="methodType == 'apHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,ap as name,sum(hits) as data1
			from 
			PAGE_HOUR_AP_STAT
		</if>
		<if test="methodType == 'apMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,ap as name,sum(hits) as data1
			from 
			PAGE_MINUTE_AP_STAT
		</if>
		<where>
			<if test="productId != null and productId != ''">
				product = #{productId}
			</if>
			<if test="businessId != null and businessId != '' and businessId != 0">
				and business_id = #{businessId}
			</if>
			<if test="nodeId != null and nodeId != '' and nodeId != 0">
				and node = #{nodeId}
			</if>
			<if test="pageId != null and pageId != '' and pageId != 0">
				and page_conf_id = #{pageId}
			</if>
			<if test="startDate != null and startDate != ''">
				and createtime >= str_to_date(#{startDate}, '%Y-%m-%d %H:%i:%s')
			</if>
			<if test="endDate != null and endDate != ''">
				and str_to_date(#{endDate}, '%Y-%m-%d %H:%i:%s') >= createtime
			</if>
			<if test="checkedValue != null and checkedValue != ''">
				and 
				<if test="methodType == 'ispDay' || methodType == 'ispHour' || methodType == 'ispMinute'">
					isp 
				</if>
				<if test="methodType == 'terminalDay' || methodType == 'terminalHour' || methodType == 'terminalMinute'">
					terminal 
				</if>
				<if test="methodType == 'cityDay' || methodType == 'cityHour' || methodType == 'cityMinute'">
					city 
				</if>
				<if test="methodType == 'clientDay' || methodType == 'clientHour' || methodType == 'clientMinute'">
					client_v 
				</if>
				<if test="methodType == 'apDay' || methodType == 'apHour' || methodType == 'apMinute'">
					ap 
				</if>
				in
				<foreach collection="checkedValArr" item="checkedItem" index="index" open="(" close=")" separator=",">
					#{checkedItem}
				</foreach>
			</if>
		</where>
		<if test="businessId == 0 || nodeId == 0 || pageId == 0">
			group by createtime order by createtime asc, sum(hits) desc
		</if>
		<if test="businessId != 0 and nodeId != 0 and pageId != 0">
			order by createtime asc, hits desc
		</if>
	</select>
	<!-- 点击量结束 -->
	
	<!-- 流量开始 -->
	<resultMap type="richinfo.mm.monitor.web.enties.TcpConnResult" id="flowResultMap">
		<result column="createtime" property="createtime" jdbcType="VARCHAR" />
		<result column="name" property="name" jdbcType="VARCHAR" />
		<result column="traffic_up" property="data1" jdbcType="FLOAT" />
		<result column="traffic_dn" property="data2" jdbcType="FLOAT" />
		<result column="traffic_total" property="data3" jdbcType="FLOAT" />
	</resultMap>
	<select id="queryFlowByCond" resultMap="flowResultMap" parameterType="TcpConnParam">
		select
		<if test="methodType == 'allDay'">
			date_format(createtime, '%Y-%m-%d') as name,sum(traffic_up) as data1,sum(traffic_dn) as data2,sum(traffic_up + traffic_dn) as traffic_total
			from 
			PAGE_DAY_STAT
		</if>
		<if test="methodType == 'allHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as name,sum(traffic_up) as data1,sum(traffic_dn) as data2,sum(traffic_up + traffic_dn) as traffic_total
			from 
			PAGE_HOUR_STAT
		</if>
		<if test="methodType == 'allMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as name,sum(traffic_up) as data1,sum(traffic_dn) as data2,sum(traffic_up + traffic_dn) as traffic_total
			from 
			PAGE_MINUTE_STAT
		</if>
		<if test="methodType == 'ispDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,isp as name,sum(traffic_up) as data1,sum(traffic_dn) as data2,sum(traffic_up + traffic_dn) as traffic_total
			from 
			PAGE_DAY_ISP_STAT
		</if>
		<if test="methodType == 'ispHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,isp as name,sum(traffic_up) as data1,sum(traffic_dn) as data2,sum(traffic_up + traffic_dn) as traffic_total
			from 
			PAGE_HOUR_ISP_STAT
		</if>
		<if test="methodType == 'ispMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,isp as name,sum(traffic_up) as data1,sum(traffic_dn) as data2,sum(traffic_up + traffic_dn) as traffic_total
			from 
			PAGE_MINUTE_ISP_STAT
		</if>
		<if test="methodType == 'terminalDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,terminal as name,sum(traffic_up) as data1,sum(traffic_dn) as data2,sum(traffic_up + traffic_dn) as traffic_total
			from 
			PAGE_DAY_TERMINAL_STAT
		</if>
		<if test="methodType == 'terminalHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,terminal as name,sum(traffic_up) as data1,sum(traffic_dn) as data2,sum(traffic_up + traffic_dn) as traffic_total
			from 
			PAGE_HOUR_TERMINAL_STAT
		</if>
		<if test="methodType == 'terminalMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,terminal as name,sum(traffic_up) as data1,sum(traffic_dn) as data2,sum(traffic_up + traffic_dn) as traffic_total
			from 
			PAGE_MINUTE_TERMINAL_STAT
		</if>
		<if test="methodType == 'cityDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,city as name,sum(traffic_up) as data1,sum(traffic_dn) as data2,sum(traffic_up + traffic_dn) as traffic_total
			from 
			PAGE_DAY_CITY_STAT
		</if>
		<if test="methodType == 'cityHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,city as name,sum(traffic_up) as data1,sum(traffic_dn) as data2,sum(traffic_up + traffic_dn) as traffic_total
			from 
			PAGE_HOUR_CITY_STAT
		</if>
		<if test="methodType == 'cityMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,city as name,sum(traffic_up) as data1,sum(traffic_dn) as data2,sum(traffic_up + traffic_dn) as traffic_total
			from 
			PAGE_MINUTE_CITY_STAT
		</if>
		<if test="methodType == 'clientDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,client_v as name,sum(traffic_up) as data1,sum(traffic_dn) as data2,sum(traffic_up + traffic_dn) as traffic_total
			from 
			PAGE_DAY_CLIENT_STAT
		</if>
		<if test="methodType == 'clientHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,client_v as name,sum(traffic_up) as data1,sum(traffic_dn) as data2,sum(traffic_up + traffic_dn) as traffic_total
			from 
			PAGE_HOUR_CLIENT_STAT
		</if>
		<if test="methodType == 'clientMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,client_v as name,sum(traffic_up) as data1,sum(traffic_dn) as data2,sum(traffic_up + traffic_dn) as traffic_total
			from 
			PAGE_MINUTE_CLIENT_STAT
		</if>
		<if test="methodType == 'apDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,ap as name,sum(traffic_up) as data1,sum(traffic_dn) as data2,sum(traffic_up + traffic_dn) as traffic_total
			from 
			PAGE_DAY_AP_STAT
		</if>
		<if test="methodType == 'apHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,ap as name,sum(traffic_up) as data1,sum(traffic_dn) as data2,sum(traffic_up + traffic_dn) as traffic_total
			from 
			PAGE_HOUR_AP_STAT
		</if>
		<if test="methodType == 'apMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,ap as name,sum(traffic_up) as data1,sum(traffic_dn) as data2,sum(traffic_up + traffic_dn) as traffic_total
			from 
			PAGE_MINUTE_AP_STAT
		</if>
		<where>
			<if test="productId != null and productId != ''">
				product = #{productId}
			</if>
			<if test="businessId != null and businessId != '' and businessId != 0">
				and business_id = #{businessId}
			</if>
			<if test="nodeId != null and nodeId != '' and nodeId != 0">
				and node = #{nodeId}
			</if>
			<if test="pageId != null and pageId != '' and pageId != 0">
				and page_conf_id = #{pageId}
			</if>
			<if test="startDate != null and startDate != ''">
				and createtime >= str_to_date(#{startDate}, '%Y-%m-%d %H:%i:%s')
			</if>
			<if test="endDate != null and endDate != ''">
				and str_to_date(#{endDate}, '%Y-%m-%d %H:%i:%s') >= createtime
			</if>
			<if test="checkedValue != null and checkedValue != ''">
				and 
				<if test="methodType == 'ispDay' || methodType == 'ispHour' || methodType == 'ispMinute'">
					isp 
				</if>
				<if test="methodType == 'terminalDay' || methodType == 'terminalHour' || methodType == 'terminalMinute'">
					terminal 
				</if>
				<if test="methodType == 'cityDay' || methodType == 'cityHour' || methodType == 'cityMinute'">
					city 
				</if>
				<if test="methodType == 'clientDay' || methodType == 'clientHour' || methodType == 'clientMinute'">
					client_v 
				</if>
				<if test="methodType == 'apDay' || methodType == 'apHour' || methodType == 'apMinute'">
					ap 
				</if>
				in
				<foreach collection="checkedValArr" item="checkedItem" index="index" open="(" close=")" separator=",">
					#{checkedItem}
				</foreach>
			</if>
		</where>
		<if test="businessId == 0 || nodeId == 0 || pageId == 0">
			group by createtime order by createtime asc, sum(traffic_up + traffic_dn) desc
		</if>
		<if test="businessId != 0 and nodeId != 0 and pageId != 0">
			order by createtime asc, (traffic_up + traffic_dn) desc
		</if>
	</select>
	<!-- 流量结束 -->
	
	<!-- 请求数开始 -->
	<resultMap type="richinfo.mm.monitor.web.enties.TcpConnResult" id="requestNumResultMap">
		<result column="createtime" property="createtime" jdbcType="VARCHAR" />
		<result column="name" property="name" jdbcType="VARCHAR" />
		<result column="req_nums" property="data1" jdbcType="FLOAT" />
	</resultMap>
	<select id="queryReqNumsByCond" resultMap="requestNumResultMap" parameterType="TcpConnParam">
		select
		<if test="methodType == 'allDay'">
			date_format(createtime, '%Y-%m-%d') as name,sum(req_nums) as data1
			from 
			PAGE_DAY_STAT
		</if>
		<if test="methodType == 'allHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as name,sum(req_nums) as data1
			from 
			PAGE_HOUR_STAT
		</if>
		<if test="methodType == 'allMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as name,sum(req_nums) as data1
			from 
			PAGE_MINUTE_STAT
		</if>
		<if test="methodType == 'ispDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,isp as name,sum(req_nums) as data1
			from 
			PAGE_DAY_ISP_STAT
		</if>
		<if test="methodType == 'ispHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,isp as name,sum(req_nums) as data1
			from 
			PAGE_HOUR_ISP_STAT
		</if>
		<if test="methodType == 'ispMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,isp as name,sum(req_nums) as data1
			from 
			PAGE_MINUTE_ISP_STAT
		</if>
		<if test="methodType == 'terminalDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,terminal as name,sum(req_nums) as data1
			from 
			PAGE_DAY_TERMINAL_STAT
		</if>
		<if test="methodType == 'terminalHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,terminal as name,sum(req_nums) as data1
			from 
			PAGE_HOUR_TERMINAL_STAT
		</if>
		<if test="methodType == 'terminalMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,terminal as name,sum(req_nums) as data1
			from 
			PAGE_MINUTE_TERMINAL_STAT
		</if>
		<if test="methodType == 'cityDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,city as name,sum(req_nums) as data1
			from 
			PAGE_DAY_CITY_STAT
		</if>
		<if test="methodType == 'cityHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,city as name,sum(req_nums) as data1
			from 
			PAGE_HOUR_CITY_STAT
		</if>
		<if test="methodType == 'cityMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,city as name,sum(req_nums) as data1
			from 
			PAGE_MINUTE_CITY_STAT
		</if>
		<if test="methodType == 'clientDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,client_v as name,sum(req_nums) as data1
			from 
			PAGE_DAY_CLIENT_STAT
		</if>
		<if test="methodType == 'clientHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,client_v as name,sum(req_nums) as data1
			from 
			PAGE_HOUR_CLIENT_STAT
		</if>
		<if test="methodType == 'clientMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,client_v as name,sum(req_nums) as data1
			from 
			PAGE_MINUTE_CLIENT_STAT
		</if>
		<if test="methodType == 'apDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,ap as name,sum(req_nums) as data1
			from 
			PAGE_DAY_AP_STAT
		</if>
		<if test="methodType == 'apHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,ap as name,sum(req_nums) as data1
			from 
			PAGE_HOUR_AP_STAT
		</if>
		<if test="methodType == 'apMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,ap as name,sum(req_nums) as data1
			from 
			PAGE_MINUTE_AP_STAT
		</if>
		<where>
			<if test="productId != null and productId != ''">
				product = #{productId}
			</if>
			<if test="businessId != null and businessId != '' and businessId != 0">
				and business_id = #{businessId}
			</if>
			<if test="nodeId != null and nodeId != '' and nodeId != 0">
				and node = #{nodeId}
			</if>
			<if test="pageId != null and pageId != '' and pageId != 0">
				and page_conf_id = #{pageId}
			</if>
			<if test="startDate != null and startDate != ''">
				and createtime >= str_to_date(#{startDate}, '%Y-%m-%d %H:%i:%s')
			</if>
			<if test="endDate != null and endDate != ''">
				and str_to_date(#{endDate}, '%Y-%m-%d %H:%i:%s') >= createtime
			</if>
			<if test="checkedValue != null and checkedValue != ''">
				and 
				<if test="methodType == 'ispDay' || methodType == 'ispHour' || methodType == 'ispMinute'">
					isp 
				</if>
				<if test="methodType == 'terminalDay' || methodType == 'terminalHour' || methodType == 'terminalMinute'">
					terminal 
				</if>
				<if test="methodType == 'cityDay' || methodType == 'cityHour' || methodType == 'cityMinute'">
					city 
				</if>
				<if test="methodType == 'clientDay' || methodType == 'clientHour' || methodType == 'clientMinute'">
					client_v 
				</if>
				<if test="methodType == 'apDay' || methodType == 'apHour' || methodType == 'apMinute'">
					ap 
				</if>
				in
				<foreach collection="checkedValArr" item="checkedItem" index="index" open="(" close=")" separator=",">
					#{checkedItem}
				</foreach>
			</if>
		</where>
		<if test="businessId == 0 || nodeId == 0 || pageId == 0">
			group by createtime order by createtime asc, sum(req_nums) desc
		</if>
		<if test="businessId != 0 and nodeId != 0 and pageId != 0">
			order by createtime asc, req_nums desc
		</if>
	</select>
	<!-- 请求数结束 -->
	
	<!-- 可用性数据 开始 -->
	<resultMap type="richinfo.mm.monitor.web.enties.TcpConnResult" id="availResultMap">
		<result column="createtime" property="createtime" jdbcType="VARCHAR" />
		<result column="name" property="name" jdbcType="VARCHAR" />
		<result column="data1" property="data1" jdbcType="FLOAT" />
	</resultMap>
	<select id="queryAvailByCond" resultMap="availResultMap" parameterType="TcpConnParam">
		select
		<if test="methodType == 'allDay'">
			date_format(createtime, '%Y-%m-%d') as name, case when hits=0 then 0 else sum(100*(error_hits/hits)) end as data1
			from 
			PAGE_DAY_STAT
		</if>
		<if test="methodType == 'allHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as name,case when hits=0 then 0 else sum(100*(error_hits/hits)) end as data1
			from 
			PAGE_HOUR_STAT
		</if>
		<if test="methodType == 'allMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as name,case when hits=0 then 0 else sum(100*(error_hits/hits)) end as data1
			from 
			PAGE_MINUTE_STAT
		</if>
		<if test="methodType == 'ispDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,isp as name,case when hits=0 then 0 else sum(100*(error_hits/hits)) end as data1
			from 
			PAGE_DAY_ISP_STAT
		</if>
		<if test="methodType == 'ispHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,isp as name,case when hits=0 then 0 else sum(100*(error_hits/hits)) end as data1
			from 
			PAGE_HOUR_ISP_STAT
		</if>
		<if test="methodType == 'ispMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,isp as name,case when hits=0 then 0 else sum(100*(error_hits/hits)) end as data1
			from 
			PAGE_MINUTE_ISP_STAT
		</if>
		<if test="methodType == 'terminalDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,terminal as name,case when hits=0 then 0 else sum(100*(error_hits/hits)) end as data1
			from 
			PAGE_DAY_TERMINAL_STAT
		</if>
		<if test="methodType == 'terminalHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,terminal as name,case when hits=0 then 0 else sum(100*(error_hits/hits)) end as data1
			from 
			PAGE_HOUR_TERMINAL_STAT
		</if>
		<if test="methodType == 'terminalMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,terminal as name,case when hits=0 then 0 else sum(100*(error_hits/hits)) end as data1
			from 
			PAGE_MINUTE_TERMINAL_STAT
		</if>
		<if test="methodType == 'cityDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,city as name,case when hits=0 then 0 else sum(100*(error_hits/hits)) end as data1
			from 
			PAGE_DAY_CITY_STAT
		</if>
		<if test="methodType == 'cityHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,city as name,case when hits=0 then 0 else sum(100*(error_hits/hits)) end as data1
			from 
			PAGE_HOUR_CITY_STAT
		</if>
		<if test="methodType == 'cityMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,city as name,case when hits=0 then 0 else sum(100*(error_hits/hits)) end as data1
			from 
			PAGE_MINUTE_CITY_STAT
		</if>
		<if test="methodType == 'clientDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,client_v as name,case when hits=0 then 0 else sum(100*(error_hits/hits)) end  as data1
			from 
			PAGE_DAY_CLIENT_STAT
		</if>
		<if test="methodType == 'clientHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,client_v as name,case when hits=0 then 0 else sum(100*(error_hits/hits)) end  as data1
			from 
			PAGE_HOUR_CLIENT_STAT
		</if>
		<if test="methodType == 'clientMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,client_v as name,case when hits=0 then 0 else sum(100*(error_hits/hits)) end as data1
			from 
			PAGE_MINUTE_CLIENT_STAT
		</if>
		<if test="methodType == 'apDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,ap as name,case when hits=0 then 0 else sum(100*(error_hits/hits)) end  as data1
			from 
			PAGE_DAY_AP_STAT
		</if>
		<if test="methodType == 'apHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,ap as name,case when hits=0 then 0 else sum(100*(error_hits/hits)) end  as data1
			from 
			PAGE_HOUR_AP_STAT
		</if>
		<if test="methodType == 'apMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,ap as name,case when hits=0 then 0 else sum(100*(error_hits/hits)) end  as data1
			from 
			PAGE_MINUTE_AP_STAT
		</if>
		<where>
			<if test="productId != null and productId != ''">
				product = #{productId}
			</if>
			<if test="businessId != null and businessId != '' and businessId != 0">
				and business_id = #{businessId}
			</if>
			<if test="nodeId != null and nodeId != '' and nodeId != 0">
				and node = #{nodeId}
			</if>
			<if test="pageId != null and pageId != '' and pageId != 0">
				and page_conf_id = #{pageId}
			</if>
			<if test="startDate != null and startDate != ''">
				and createtime >= str_to_date(#{startDate}, '%Y-%m-%d %H:%i:%s')
			</if>
			<if test="endDate != null and endDate != ''">
				and str_to_date(#{endDate}, '%Y-%m-%d %H:%i:%s') >= createtime
			</if>
			<if test="checkedValue != null and checkedValue != ''">
				and 
				<if test="methodType == 'ispDay' || methodType == 'ispHour' || methodType == 'ispMinute'">
					isp 
				</if>
				<if test="methodType == 'terminalDay' || methodType == 'terminalHour' || methodType == 'terminalMinute'">
					terminal 
				</if>
				<if test="methodType == 'cityDay' || methodType == 'cityHour' || methodType == 'cityMinute'">
					city 
				</if>
				<if test="methodType == 'clientDay' || methodType == 'clientHour' || methodType == 'clientMinute'">
					client_v 
				</if>
				<if test="methodType == 'apDay' || methodType == 'apHour' || methodType == 'apMinute'">
					ap 
				</if>
				in
				<foreach collection="checkedValArr" item="checkedItem" index="index" open="(" close=")" separator=",">
					#{checkedItem}
				</foreach>
			</if>
		</where>
		<if test="businessId == 0 || nodeId == 0 || pageId == 0">
			group by createtime order by createtime asc, sum(error_hits/hits) desc
		</if>
		<if test="businessId != 0 and nodeId != 0 and pageId != 0">
			order by createtime asc, (error_hits/hits) desc
		</if>
	</select>
	<!-- 可用性数据 结束 -->
	
	<!-- 错误概况分析开始 -->
	<resultMap type="richinfo.mm.monitor.web.enties.TcpConnResult" id="errorResultMap">
		<result column="createtime" property="createtime" jdbcType="VARCHAR" />
		<result column="name" property="name" jdbcType="VARCHAR" />
		<result column="error_hits" property="data1" jdbcType="FLOAT" />
	</resultMap>
	<select id="queryErrorsByCond" resultMap="errorResultMap" parameterType="TcpConnParam">
		select
		<if test="methodType == 'allDay'">
			date_format(createtime, '%Y-%m-%d') as name,sum(error_hits) as data1
			from 
			PAGE_DAY_STAT
		</if>
		<if test="methodType == 'allHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as name,sum(error_hits) as data1
			from 
			PAGE_HOUR_STAT
		</if>
		<if test="methodType == 'allMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as name,sum(error_hits) as data1
			from 
			PAGE_MINUTE_STAT
		</if>
		<if test="methodType == 'ispDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,isp as name,sum(error_hits) as data1
			from 
			PAGE_DAY_ISP_STAT
		</if>
		<if test="methodType == 'ispHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,isp as name,sum(error_hits) as data1
			from 
			PAGE_HOUR_ISP_STAT
		</if>
		<if test="methodType == 'ispMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,isp as name,sum(error_hits) as data1
			from 
			PAGE_MINUTE_ISP_STAT
		</if>
		<if test="methodType == 'terminalDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,terminal as name,sum(error_hits) as data1
			from 
			PAGE_DAY_TERMINAL_STAT
		</if>
		<if test="methodType == 'terminalHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,terminal as name,sum(error_hits) as data1
			from 
			PAGE_HOUR_TERMINAL_STAT
		</if>
		<if test="methodType == 'terminalMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,terminal as name,sum(error_hits) as data1
			from 
			PAGE_MINUTE_TERMINAL_STAT
		</if>
		<if test="methodType == 'cityDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,city as name,sum(error_hits) as data1
			from 
			PAGE_DAY_CITY_STAT
		</if>
		<if test="methodType == 'cityHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,city as name,sum(error_hits) as data1
			from 
			PAGE_HOUR_CITY_STAT
		</if>
		<if test="methodType == 'cityMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,city as name,sum(error_hits) as data1
			from 
			PAGE_MINUTE_CITY_STAT
		</if>
		<if test="methodType == 'clientDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,client_v as name,sum(error_hits) as data1
			from 
			PAGE_DAY_CLIENT_STAT
		</if>
		<if test="methodType == 'clientHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,client_v as name,sum(error_hits) as data1
			from 
			PAGE_HOUR_CLIENT_STAT
		</if>
		<if test="methodType == 'clientMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,client_v as name,sum(error_hits) as data1
			from 
			PAGE_MINUTE_CLIENT_STAT
		</if>
		<if test="methodType == 'apDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,ap as name,sum(error_hits) as data1
			from 
			PAGE_DAY_AP_STAT
		</if>
		<if test="methodType == 'apHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,ap as name,sum(error_hits) as data1
			from 
			PAGE_HOUR_AP_STAT
		</if>
		<if test="methodType == 'apMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,ap as name,sum(error_hits) as data1
			from 
			PAGE_MINUTE_AP_STAT
		</if>
		<if test="methodType == 'errorDay'">
			date_format(createtime, '%Y-%m-%d') as createtime,faultno as name,sum(error_hits) as data1
			from 
			PAGE_DAY_FAULT_STAT
		</if>
		<if test="methodType == 'errorHour'">
			concat(date_format(createtime, '%Y-%m-%d %H'),':00') as createtime,faultno as name,sum(error_hits) as data1
			from 
			PAGE_HOUR_FAULT_STAT
		</if>
		<if test="methodType == 'errorMinute'">
			date_format(createtime, 'Y-%m-%d %H:%i') as createtime,faultno as name,sum(error_hits) as data1
			from 
			PAGE_MINUTE_FAULT_STAT
		</if>
		<where>
			<if test="productId != null and productId != ''">
				product = #{productId}
			</if>
			<if test="businessId != null and businessId != '' and businessId != 0">
				and business_id = #{businessId}
			</if>
			<if test="nodeId != null and nodeId != '' and nodeId != 0">
				and node = #{nodeId}
			</if>
			<if test="pageId != null and pageId != '' and pageId != 0">
				and page_conf_id = #{pageId}
			</if>
			<if test="startDate != null and startDate != ''">
				and createtime >= str_to_date(#{startDate}, '%Y-%m-%d %H:%i:%s')
			</if>
			<if test="endDate != null and endDate != ''">
				and str_to_date(#{endDate}, '%Y-%m-%d %H:%i:%s') >= createtime
			</if>
			<if test="checkedValue != null and checkedValue != ''">
				and 
				<if test="methodType == 'ispDay' || methodType == 'ispHour' || methodType == 'ispMinute'">
					isp 
				</if>
				<if test="methodType == 'terminalDay' || methodType == 'terminalHour' || methodType == 'terminalMinute'">
					terminal 
				</if>
				<if test="methodType == 'cityDay' || methodType == 'cityHour' || methodType == 'cityMinute'">
					city 
				</if>
				<if test="methodType == 'clientDay' || methodType == 'clientHour' || methodType == 'clientMinute'">
					client_v 
				</if>
				<if test="methodType == 'apDay' || methodType == 'apHour' || methodType == 'apMinute'">
					ap 
				</if>
				<if test="methodType == 'errorDay' || methodType == 'errorHour' || methodType == 'errorMinute'">
					faultno 
				</if>
				in
				<foreach collection="checkedValArr" item="checkedItem" index="index" open="(" close=")" separator=",">
					#{checkedItem}
				</foreach>
			</if>
		</where>
		<if test="businessId == 0 || nodeId == 0 || pageId == 0">
			group by createtime order by createtime asc, sum(error_hits) desc
		</if>
		<if test="businessId != 0 and nodeId != 0 and pageId != 0">
			order by createtime asc, error_hits desc
		</if>
	</select>
	<!-- 错误概况分析结束 -->
	
	<!-- 最差用户分布开始 -->
	<resultMap type="richinfo.mm.monitor.web.enties.TcpConnResult" id="worstuserResultMap">
		<result column="createtime" property="createtime" jdbcType="VARCHAR" />
		<result column="name" property="name" jdbcType="VARCHAR" />
		<result column="data1" property="y" jdbcType="FLOAT" />
	</resultMap>
	<select id="queryWorstuserByCond" resultMap="worstuserResultMap" parameterType="TcpConnParam">
		select
		<if test="methodType == 'ispDay'">
			isp as createtime,isp as name,count(distinct phone) as data1
		</if>
		<if test="methodType == 'ispHour'">
			isp as createtime,isp as name,count(distinct phone) as data1
		</if>
		<if test="methodType == 'ispMinute'">
			isp as createtime,isp as name,count(distinct phone) as data1
		</if>
		<if test="methodType == 'terminalDay'">
			terminal as createtime,terminal as name,count(distinct phone) as data1
		</if>
		<if test="methodType == 'terminalHour'">
			terminal as createtime,terminal as name,count(distinct phone) as data1
		</if>
		<if test="methodType == 'terminalMinute'">
			terminal as createtime,terminal as name,count(distinct phone) as data1
		</if>
		<if test="methodType == 'cityDay'">
			city as createtime,city as name,count(distinct phone) as data1
		</if>
		<if test="methodType == 'cityHour'">
			city as createtime,city as name,count(distinct phone) as data1
		</if>
		<if test="methodType == 'cityMinute'">
			city as createtime,city as name,count(distinct phone) as data1
		</if>
		from page_details
		<where>
			<if test="productId != null and productId != ''">
				product = #{productId}
			</if>
			<if test="startDate != null and startDate != ''">
				and createtime >= str_to_date(#{startDate}, '%Y-%m-%d %H:%i:%s')
			</if>
			<if test="endDate != null and endDate != ''">
				and str_to_date(#{endDate}, '%Y-%m-%d %H:%i:%s') >= createtime
			</if>
		</where>
		<if test="methodType == 'cityDay' || methodType == 'cityHour' || methodType == 'cityMinute'">
			and city in (select t.city from (select  city  from page_details 
		</if>
		<if test="methodType == 'ispDay' || methodType == 'ispHour' || methodType == 'ispMinute'">
			and isp in (select t.isp from (select  isp  from page_details 
		</if>
		<if test="methodType == 'terminalDay' || methodType == 'terminalHour' || methodType == 'terminalMinute'">
			and terminal in (select t.terminal from (select  terminal  from page_details 
		</if>
		<where>
			<if test="productId != null and productId != ''">
				product = #{productId}
			</if>
			<if test="startDate != null and startDate != ''">
				and createtime >= str_to_date(#{startDate}, '%Y-%m-%d %H:%i:%s')
			</if>
			<if test="endDate != null and endDate != ''">
				and str_to_date(#{endDate}, '%Y-%m-%d %H:%i:%s') >= createtime
			</if>
		</where>
		<if test="methodType == 'ispDay' || methodType == 'ispHour' || methodType == 'ispMinute'">
			group by isp 
		</if>
		<if test="methodType == 'terminalDay' || methodType == 'terminalHour' || methodType == 'terminalMinute'">
			group by terminal 
		</if>
		<if test="methodType == 'cityDay' || methodType == 'cityHour' || methodType == 'cityMinute'">
			group by city 
		</if>
		<if test="businessId == 0">
			order by (1-sum(ERROR_hits)/sum(hits)) limit 0,10) t)
		</if>
		<if test="businessId == 1">
			order by resp_time desc limit 0,10) t)
		</if>
		<if test="methodType == 'ispDay' || methodType == 'ispHour' || methodType == 'ispMinute'">
			group by isp 
		</if>
		<if test="methodType == 'terminalDay' || methodType == 'terminalHour' || methodType == 'terminalMinute'">
			group by terminal 
		</if>
		<if test="methodType == 'cityDay' || methodType == 'cityHour' || methodType == 'cityMinute'">
			group by city 
		</if>
	</select>
	<!-- 最差用户分布结束 -->
	<!-- 用户行为轨迹开始 -->
  <resultMap id="bhResultMap" type="richinfo.mm.monitor.web.enties.UserBehavior" >
    <id column="ID" property="id" jdbcType="INTEGER" />
    <result column="phone" property="phone" jdbcType="VARCHAR" />
    <result column="src_ip" property="src_ip" jdbcType="VARCHAR" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="url" property="url" jdbcType="VARCHAR" />
    <result column="imsi" property="imsi" jdbcType="VARCHAR" />
    <result column="resp_time" property="resp_time" jdbcType="INTEGER" />
    <result column="http_status" property="http_status" jdbcType="VARCHAR" />
    <result column="visit_start_time" property="visit_start_time" jdbcType="TIMESTAMP" />
  </resultMap>

	<select id="getListPage" parameterType="richinfo.mm.monitor.web.enties.UserBehavior" resultMap="bhResultMap">
	select pd.id,pd.phone,pd.src_ip,pc.name,pd.url,pd.imsi,pd.resp_time,pd.http_status,pd.visit_start_time from page_details pd,page_conf pc 
		<where>
		  pd.page_conf_id=pc.id	
		    <if test="bh.phone!=null">
				and pd.phone like CONCAT('%',#{bh.phone},'%')  
			</if>
			<if test="bh.src_ip!=null">
				and pd.src_ip like CONCAT('%',#{bh.src_ip},'%')  
			</if>
			<if test="bh.imsi!=null">
				and pd.imsi like CONCAT('%',#{bh.imsi},'%')  
			</if>
			<if test="visit_start_time!=null and visit_start_time!=''">
	   			<!-- and pd.visit_start_time  &gt;= #{bh.visit_start_time} -->
	   			and pd.visit_start_time  >= str_to_date(concat(#{visit_start_time},' 00:00:00'), '%Y-%m-%d %H:%i:%s')
	   			and str_to_date(concat(#{visit_start_time},' 23:59:59'), '%Y-%m-%d %H:%i:%s')  >= pd.visit_start_time
	   		</if>
		</where>
	</select>
	
  <resultMap id="usrBehaviorMap" type="richinfo.mm.monitor.web.enties.UserBehavior" >
    <id column="ID" property="id" jdbcType="INTEGER" />
    <result column="phone" property="phone" jdbcType="VARCHAR" />
    <result column="src_ip" property="src_ip" jdbcType="VARCHAR" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="url" property="url" jdbcType="VARCHAR" />
    <result column="imsi" property="imsi" jdbcType="VARCHAR" />
    <result column="resp_time" property="resp_time" jdbcType="INTEGER" />
    <result column="http_status" property="http_status" jdbcType="VARCHAR" />
    <result column="visit_start_time" property="visit_start_time" jdbcType="TIMESTAMP" />
    
    <result column="province" property="province" jdbcType="VARCHAR" />
    <result column="city" property="city" jdbcType="VARCHAR" />
    <result column="isp" property="isp" jdbcType="VARCHAR" />
    <result column="sessionid" property="sessionid" jdbcType="VARCHAR" />
    <result column="server_time" property="server_time" jdbcType="INTEGER" />
    <result column="net_time" property="net_time" jdbcType="INTEGER" />
    <result column="browser_v" property="browser_v" jdbcType="VARCHAR" />
    <result column="ops" property="ops" jdbcType="VARCHAR" />
    
    <result column="terminal" property="terminal" jdbcType="VARCHAR" />
    <result column="client_v" property="client_v" jdbcType="VARCHAR" />
    <result column="content_encoding" property="content_encoding" jdbcType="VARCHAR" />
    <result column="username" property="username" jdbcType="VARCHAR" />
    <result column="cache_filename" property="cache_filename" jdbcType="VARCHAR" />
  </resultMap>
  
	
	<select id="detail" parameterType="INTEGER" resultMap="usrBehaviorMap">
		select pd.id,pd.phone,pd.src_ip,pc.name,pd.url,pd.imsi,pd.resp_time,pd.http_status,pd.visit_start_time,
		ci.province,ci.city,pd.isp,pd.sessionid,pd.server_time,pd.net_time,pd.browser_v,pd.ops,pd.terminal,pd.client_v,
		pd.content_encoding,pd.username,pd.cache_filename from page_details pd,page_conf pc,city_info ci 
		<where>
		  and pd.page_conf_id=pc.id	and pd.id= #{id} and pd.province=ci.prov_code and pd.city=ci.city_code
		</where>
	</select>
	
	<select id="export" resultMap="usrBehaviorMap">
		select pd.id,pd.phone,pd.src_ip,pc.name,pd.url,pd.imsi,pd.resp_time,pd.http_status,pd.visit_start_time,
		pd.province,pd.city,pd.isp,pd.sessionid,pd.server_time,pd.net_time,pd.browser_v,pd.ops,pd.terminal,pd.client_v,
		pd.content_encoding,pd.username,pd.cache_filename from page_details pd,page_conf pc 
		<where>
		  and pd.page_conf_id=pc.id	
		</where>
	</select>
	<!-- 用户行为轨迹结束 -->
	
</mapper>